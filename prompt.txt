-- current level model
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;

class Level extends Model
{
    protected $fillable = [
        'semester_id',
        'name',
    ];

    /**
     * Get the semester that owns the level.
     */
    public function semester(): BelongsTo
    {
        return $this->belongsTo(Semester::class);
    }

    /**
     * Get the courses for the level.
     */
    public function courses(): HasMany
    {
        return $this->hasMany(Course::class);
    }

    /**
     * Get the school fees for the level.
     */
    public function schoolFees(): HasMany
    {
        return $this->hasMany(SchoolFee::class);
    }

    /**
     * Get the results for the level.
     */
    public function results(): HasMany
    {
        return $this->hasMany(Result::class);
    }
}



<?php

namespace Database\Seeders;

use App\Models\SchoolSession;
use App\Models\Semester;
use Illuminate\Database\Seeder;

class SemesterSeeder extends Seeder
{
    /**
     * Run the database seeds.
     *
     * @return void
     */
    public function run(): void
    {
        // recent school session
        $schoolSession = SchoolSession::orderBy('year', 'desc')->first();

        // Check if a school session exists
        if ($schoolSession) {
         
            Semester::create([
                'semester_name' => 'First Semester',
                'school_session_id' => $schoolSession->id,
                'is_current' => true, 
            ]);

      
            Semester::create([
                'semester_name' => 'Second Semester',
                'school_session_id' => $schoolSession->id,
            ]);
        }
    }
}


<?php

namespace Database\Seeders;

use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;
use App\Models\Level;
use App\Models\Semester;

class LevelSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        // Get existing semesters to create realistic relationships
        $semesters = Semester::all();

        // If no semesters exist, create some basic ones first
        if ($semesters->isEmpty()) {
            $this->command->warn('Please ensure semesters table has data before running this seeder.');
            return;
        }

        // Sample academic levels for different semester types
        $levelData = [
            // For First Semester
            [
                'semester_name' => 'First Semester',
                'levels' => [
                    ['name' => '100 Level', 'description' => 'First year students - Foundation level'],
                    ['name' => '200 Level', 'description' => 'Second year students - Intermediate level'],
                    ['name' => '300 Level', 'description' => 'Third year students - Advanced level'],
                    ['name' => '400 Level', 'description' => 'Fourth year students - Final year level'],
                    ['name' => '500 Level', 'description' => 'Fifth year students - Professional level (for 5-year programs)'],
                ]
            ],
            // For Second Semester
            [
                'semester_name' => 'Second Semester',
                'levels' => [
                    ['name' => '100 Level', 'description' => 'First year students - Foundation level'],
                    ['name' => '200 Level', 'description' => 'Second year students - Intermediate level'],
                    ['name' => '300 Level', 'description' => 'Third year students - Advanced level'],
                    ['name' => '400 Level', 'description' => 'Fourth year students - Final year level'],
                    ['name' => '500 Level', 'description' => 'Fifth year students - Professional level (for 5-year programs)'],
                ]
            ],
            // For Summer Semester (if exists)
            [
                'semester_name' => 'Summer Semester',
                'levels' => [
                    ['name' => '100 Level', 'description' => 'First year students - Foundation level'],
                    ['name' => '200 Level', 'description' => 'Second year students - Intermediate level'],
                    ['name' => '300 Level', 'description' => 'Third year students - Advanced level'],
                    ['name' => '400 Level', 'description' => 'Fourth year students - Final year level'],
                ]
            ]
        ];

        $levelsCreated = 0;

        foreach ($levelData as $semesterLevels) {
            // Find the semester by name (case-insensitive)
            $semester = $semesters->first(function ($sem) use ($semesterLevels) {
                return stripos($sem->name, str_replace(' Semester', '', $semesterLevels['semester_name'])) !== false;
            });

            // If semester not found, use the first available semester
            if (!$semester) {
                $semester = $semesters->first();
            }

            foreach ($semesterLevels['levels'] as $levelInfo) {
                // Check if level already exists for this semester
                $existingLevel = Level::where('semester_id', $semester->id)
                    ->where('name', $levelInfo['name'])
                    ->first();

                if (!$existingLevel) {
                    Level::create([
                        'semester_id' => $semester->id,
                        'name' => $levelInfo['name'],
                        'created_at' => now(),
                        'updated_at' => now(),
                    ]);
                    $levelsCreated++;
                }
            }
        }

        // Create additional specialized levels if needed
        $specializedLevels = [
            ['name' => 'Pre-Degree', 'description' => 'Preparatory program for university admission'],
            ['name' => 'Remedial', 'description' => 'Remedial program for academic improvement'],
            ['name' => 'Postgraduate', 'description' => 'Masters and PhD level students'],
        ];

        $firstSemester = $semesters->first();
        foreach ($specializedLevels as $specialLevel) {
            $existingLevel = Level::where('semester_id', $firstSemester->id)
                ->where('name', $specialLevel['name'])
                ->first();

            if (!$existingLevel) {
                Level::create([
                    'semester_id' => $firstSemester->id,
                    'name' => $specialLevel['name'],
                    'created_at' => now(),
                    'updated_at' => now(),
                ]);
                $levelsCreated++;
            }
        }

        $this->command->info("Level seeder completed successfully! Created {$levelsCreated} new level records.");
        $this->command->info('Total levels in database: ' . Level::count());
    }
}
