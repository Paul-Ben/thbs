<?php

namespace Database\Seeders;


use Illuminate\Database\Seeder;
use App\Models\Semester;
use App\Models\SchoolSession;


class SemesterSeeder extends Seeder
{
    /**
     * Run the database seeds.

     */
    public function run(): void
    {
        // Ensure there is at least one school session
        $currentSession = SchoolSession::where('is_current', true)->first();
        if (!$currentSession) {
            $currentSession = SchoolSession::first();
        }

        if (!$currentSession) {
            $this->command->warn('No school sessions found. Run SchoolSession seeder first.');
            return;
        }

        $semesters = [
            ['semester_name' => 'First Semester',  'school_session_id' => $currentSession->id, 'is_current' => true],
            ['semester_name' => 'Second Semester', 'school_session_id' => $currentSession->id, 'is_current' => false],
        ];

        foreach ($semesters as $data) {
            Semester::firstOrCreate(
                [
                    'semester_name' => $data['semester_name'],
                    'school_session_id' => $data['school_session_id'],
                ],
                [
                    'is_current' => $data['is_current'],
                ]
            );
        }
    }
}




<?php

namespace Database\Seeders;

use App\Models\Course;
use App\Models\Programme;
use App\Models\Semester;
use App\Models\Level;
use Illuminate\Database\Seeder;

class CourseSeeder extends Seeder
{
    /**
     * Run the database seeds.
     *
     * @return void
     */
    public function run(): void
    {
        $this->command->info('Starting CourseSeeder...');
        
        // Debug: Show available programmes
        $programmes = Programme::all();
        $this->command->info('Available programmes: ' . $programmes->pluck('name')->implode(', '));
        
        // Debug: Show available semesters
        $semesters = Semester::all();
        $this->command->info('Available semesters: ' . $semesters->pluck('semester_name')->implode(', '));
        
        // Debug: Show available levels
        $levels = Level::with('semester')->get();
        $this->command->info('Available levels:');
        foreach ($levels as $level) {
            $this->command->line("  - {$level->name} (Semester: {$level->semester->semester_name}, ID: {$level->id})");
        }

        // Try to find programmes with flexible matching
        $nursingProgramme = Programme::where('name', 'LIKE', '%Nursing%')->first();
        $medicineProgramme = Programme::where('name', 'LIKE', '%Medicine%')->first();

        // If not found, use first available programmes
        if (!$nursingProgramme && $programmes->count() > 0) {
            $nursingProgramme = $programmes->first();
            $this->command->warn("Nursing programme not found, using: {$nursingProgramme->name}");
        }

        if (!$medicineProgramme && $programmes->count() > 1) {
            $medicineProgramme = $programmes->skip(1)->first();
            $this->command->warn("Medicine programme not found, using: {$medicineProgramme->name}");
        }

        // Find semesters
        $firstSemester = Semester::where('semester_name', 'First Semester')->first();
        $secondSemester = Semester::where('semester_name', 'Second Semester')->first();

        if (!$nursingProgramme || !$medicineProgramme) {
            $this->command->error('Not enough programmes found. Please ensure programmes are seeded first.');
            return;
        }

        if (!$firstSemester || !$secondSemester) {
            $this->command->error('Required semesters not found. Please ensure semesters are seeded first.');
            return;
        }

        $this->command->info("Using programmes:");
        $this->command->line("  - Nursing: {$nursingProgramme->name} (ID: {$nursingProgramme->id})");
        $this->command->line("  - Medicine: {$medicineProgramme->name} (ID: {$medicineProgramme->id})");
        
        $this->command->info("Using semesters:");
        $this->command->line("  - First: {$firstSemester->semester_name} (ID: {$firstSemester->id})");
        $this->command->line("  - Second: {$secondSemester->semester_name} (ID: {$secondSemester->id})");

        // Helper function to find level
        $findLevel = function (string $levelName, int $semesterId) {
            $level = Level::where('name', $levelName)
                        ->where('semester_id', $semesterId)
                        ->first();
            
            if ($level) {
                $this->command->info("Found level: {$levelName} (ID: {$level->id}) for semester ID: {$semesterId}");
            } else {
                $this->command->warn("Level not found: {$levelName} for semester ID: {$semesterId}");
            }
            
            return $level;
        };

        $coursesCreated = 0;

        // 100 Level courses for First Semester
        $this->command->info('Creating 100 Level courses for First Semester...');
        $level100_firstSem = $findLevel('100 Level', $firstSemester->id);
        if ($level100_firstSem) {
            // Check if course already exists
            if (!Course::where('code', 'NUR101')->exists()) {
                Course::create([
                    'code' => 'NUR101',
                    'title' => 'Introduction to Nursing',
                    'programme_id' => $nursingProgramme->id,
                    'semester_id' => $firstSemester->id,
                    'level_id' => $level100_firstSem->id,
                ]);
                $coursesCreated++;
                $this->command->info('Created: NUR101 - Introduction to Nursing');
            }

            if (!Course::where('code', 'MED101')->exists()) {
                Course::create([
                    'code' => 'MED101',
                    'title' => 'Human Anatomy I',
                    'programme_id' => $medicineProgramme->id,
                    'semester_id' => $firstSemester->id,
                    'level_id' => $level100_firstSem->id,
                ]);
                $coursesCreated++;
                $this->command->info('Created: MED101 - Human Anatomy I');
            }
        }

        // 100 Level courses for Second Semester
        $this->command->info('Creating 100 Level courses for Second Semester...');
        $level100_secondSem = $findLevel('100 Level', $secondSemester->id);
        if ($level100_secondSem) {
            if (!Course::where('code', 'NUR102')->exists()) {
                Course::create([
                    'code' => 'NUR102',
                    'title' => 'Fundamentals of Nursing Practice',
                    'programme_id' => $nursingProgramme->id,
                    'semester_id' => $secondSemester->id,
                    'level_id' => $level100_secondSem->id,
                ]);
                $coursesCreated++;
                $this->command->info('Created: NUR102 - Fundamentals of Nursing Practice');
            }

            if (!Course::where('code', 'MED102')->exists()) {
                Course::create([
                    'code' => 'MED102',
                    'title' => 'Human Physiology I',
                    'programme_id' => $medicineProgramme->id,
                    'semester_id' => $secondSemester->id,
                    'level_id' => $level100_secondSem->id,
                ]);
                $coursesCreated++;
                $this->command->info('Created: MED102 - Human Physiology I');
            }
        }

        // 200 Level courses for First Semester
        $this->command->info('Creating 200 Level courses for First Semester...');
        $level200_firstSem = $findLevel('200 Level', $firstSemester->id);
        if ($level200_firstSem) {
            if (!Course::where('code', 'NUR201')->exists()) {
                Course::create([
                    'code' => 'NUR201',
                    'title' => 'Medical-Surgical Nursing',
                    'programme_id' => $nursingProgramme->id,
                    'semester_id' => $firstSemester->id,
                    'level_id' => $level200_firstSem->id,
                ]);
                $coursesCreated++;
                $this->command->info('Created: NUR201 - Medical-Surgical Nursing');
            }

            if (!Course::where('code', 'MED201')->exists()) {
                Course::create([
                    'code' => 'MED201',
                    'title' => 'Medical Biochemistry',
                    'programme_id' => $medicineProgramme->id,
                    'semester_id' => $firstSemester->id,
                    'level_id' => $level200_firstSem->id,
                ]);
                $coursesCreated++;
                $this->command->info('Created: MED201 - Medical Biochemistry');
            }
        }

        $this->command->info("CourseSeeder completed!");
        $this->command->info("Created {$coursesCreated} new courses.");
        $this->command->info("Total courses in database: " . Course::count());
        
        // Show created courses
        $courses = Course::with(['programme', 'semester', 'level'])->get();
        $this->command->info("All courses in database:");
        foreach ($courses as $course) {
            $this->command->line("  - {$course->code}: {$course->title} ({$course->programme->name}, {$course->semester->semester_name}, {$course->level->name})");
        }
    }
}

